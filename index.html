<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calabazas Bits</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="header">
    <h1 class="title">Calabazas Bits</h1>
    <div class="subtitle">Datos referenciales a Argentina</div>
    <div class="time-grid">
      <div class="card">
        <div class="card-title">Hora local</div>
        <div id="time-local" class="clock">--:--:--</div>
        <div id="date-local" class="date">----</div>
      </div>
      <div class="card">
        <div class="card-title">Hora UTC</div>
        <div id="time-utc" class="clock">--:--:--</div>
        <div id="date-utc" class="date">----</div>
      </div>
    </div>
  </header>

<section class="card refs-card">
  <h2>Buscar ciudad en Argentina</h2>
  <input type="text" id="cityInput" placeholder="Escribe el nombre de la ciudad..." />
  <button onclick="searchCity()">Buscar</button>
  <ul id="results" class="refs-list"></ul>
</section>

<section class="card refs-card" id="weatherSection">
  <h2>Clima actual y pronóstico</h2>
  <div id="weather"></div>
</section>

<script>
// Función para convertir grados en punto cardinal
function gradosAPuntoCardinal(grados) {
  const direcciones = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE",
                       "S", "SSO", "SO", "OSO", "O", "ONO", "NO", "NNO"];
  const idx = Math.round(grados / 22.5) % 16;
  return direcciones[idx];
}

function searchCity() {
  const city = document.getElementById("cityInput").value;
  const url = `https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&country=Argentina&format=json`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const resultsList = document.getElementById("results");
      resultsList.innerHTML = "";

      if (data.length === 0) {
        resultsList.innerHTML = "<li>No se encontraron coincidencias</li>";
        return;
      }

      data.forEach(place => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${place.display_name}</strong>`;
        li.onclick = () => {
          resultsList.innerHTML = ""; // limpiar resultados
          getWeather(place.lat, place.lon, place.display_name);
        };
        resultsList.appendChild(li);
      });
    })
    .catch(err => console.error(err));
}

function getWeather(lat, lon, name) {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,surface_pressure,windgusts_10m&daily=temperature_2m_max,temperature_2m_min,windspeed_10m_max,windgusts_10m_max,weathercode&timezone=auto`;

  fetch(url)
    .then(res => res.json())
    .then(data => {
      const weatherDiv = document.getElementById("weather");
      const current = data.current_weather;
      const hourly = data.hourly;
      const daily = data.daily;

      // Tomamos humedad y presión de la primera hora disponible
      const humedad = hourly.relativehumidity_2m[0];
      const presion = hourly.surface_pressure[0];
      const rafagas = hourly.windgusts_10m[0];

      // Interpretación del código de clima
      const weatherCodes = {
        0: "Despejado",
        1: "Mayormente despejado",
        2: "Parcialmente nublado",
        3: "Nublado",
        61: "Chubascos ligeros",
        63: "Chubascos moderados",
        65: "Chubascos intensos"
      };
      const todayForecast = weatherCodes[daily.weathercode[0]] || "Condición desconocida";
      const tomorrowForecast = weatherCodes[daily.weathercode[1]] || "Condición desconocida";

      const direccion = gradosAPuntoCardinal(current.winddirection);

      weatherDiv.innerHTML = `
        <h3>${name}</h3>
        <h4 class="card-title">Actual</h4>
        <p>Temperatura: ${current.temperature} °C</p>
        <p>Humedad: ${humedad} %</p>
        <p>Presión: ${presion} hPa</p>
        <p>Viento: ${current.windspeed} km/h</p>
        <p>Ráfagas: ${rafagas} km/h</p>
        <p>Dirección: ${direccion} (${current.winddirection}°)</p>
        <p>Pronóstico: ${todayForecast}</p>

        <h4 class="card-title">Mañana</h4>
        <p>Mín/Máx: ${daily.temperature_2m_min[1]} / ${daily.temperature_2m_max[1]} °C</p>
        <p>Viento máx: ${daily.windspeed_10m_max[1]} km/h</p>
        <p>Ráfaga máx: ${daily.windgusts_10m_max[1]} km/h</p>
        <p>Pronóstico: ${tomorrowForecast}</p>
      `;
    })
    .catch(err => console.error(err));
}
</script>

    <section>
      <h2>Condiciones solares y aperturas de bandas</h2>
      <div class="grid">
        <div class="card">
          <div class="card-title">Índices</div>
          <div class="kv"><span class="k">SFI:</span><span id="sfi">--</span></div>
          <div class="kv"><span class="k">Kp:</span><span id="kp">--</span></div>
          <div class="kv"><span class="k">A:</span><span id="a-index">--</span></div>
          <div class="kv"><span class="k">MUF estimada:</span><span id="muf">-- MHz</span></div>
        </div>
        <div class="card">
          <div class="card-title">Bandas</div>
          <ul class="bands" id="bands-list">
            <li>HF baja (160/80 m): --</li>
            <li>HF media (40/30 m): --</li>
            <li>HF alta (20/17/15 m): --</li>
            <li>10 m: --</li>
            <li>6 m: --</li>
          </ul>
          <div class="kv"><span class="k">Ventanas:</span><span id="windows">--</span></div>
        </div>
      </div>
    </section>

    <section class="card refs-card" aria-labelledby="indices-title">
    <h2 id="indices-title">Interpretación de índices</h2>

    <!-- SFI -->
    <h3>Solar Flux Index (SFI)</h3>
    <ul class="refs-list">
        <li>
        <strong>SFI bajo (menor a 80):</strong>
        La actividad solar es débil. Las bandas altas como 15 m y 10 m suelen permanecer cerradas. Se recomienda operar en bandas bajas (40 m y 80 m).
        </li>
        <li>
        <strong>SFI medio (80–120):</strong>
        La propagación mejora en 20 m y puede haber aperturas ocasionales en 15 m. Las bandas altas aún son inestables.
        </li>
        <li>
        <strong>SFI alto (120–160):</strong>
        Buenas condiciones en 20 m y 15 m, con posibilidades frecuentes de apertura en 10 m.
        </li>
        <li>
        <strong>SFI muy alto (mayor a 160):</strong>
        Excelente propagación en bandas altas. La banda de 10 m suele estar abierta gran parte del día, ideal para DX.
        </li>
    </ul>

    <!-- Kp -->
    <h3>Índice planetario (Kp)</h3>
    <ul class="refs-list">
        <li>
        <strong>Kp muy bajo (0–2):</strong>
        Campo geomagnético tranquilo. Propagación en HF y VHF estable, con poco ruido.
        </li>
        <li>
        <strong>Kp moderado (3–4):</strong>
        Perturbaciones leves. Puede aumentar el ruido en HF, especialmente en bandas bajas, y afectar rutas polares.
        </li>
        <li>
        <strong>Kp alto (5–6):</strong>
        Tormenta geomagnética moderada. La propagación en HF se degrada notablemente, con cierres parciales en bandas altas.
        </li>
        <li>
        <strong>Kp muy alto (7–9):</strong>
        Tormenta geomagnética severa. HF puede quedar inutilizable y VHF mostrar propagación auroral.
        </li>
    </ul>

    <!-- A -->
    <h3>Índice A</h3>
    <ul class="refs-list">
        <li>
        <strong>A bajo (0–10):</strong>
        Campo geomagnético estable. Propagación confiable y predecible, ideal para DX.
        </li>
        <li>
        <strong>A moderado (11–30):</strong>
        Perturbación geomagnética moderada. La propagación se vuelve variable, con desvanecimientos y más ruido en HF.
        </li>
        <li>
        <strong>A alto (&gt;30):</strong>
        Campo geomagnético muy perturbado. Propagación degradada, cierres frecuentes y condiciones desfavorables para DX.
        </li>
    </ul>
    </section>

    <section class="card refs-card" aria-labelledby="refs-title">
    <h2 id="refs-title">Referencias de propagación</h2>
    <ul class="refs-list">
        <li>
        <strong>Posible Es/TEP:</strong>
        Aperturas irregulares en VHF (6 m/2 m) por capa E o rutas transecuatoriales. Buscar saltos medio‑largos.
        </li>
        <li>
        <strong>Tropo/ducto:</strong>
        Condiciones troposféricas abren VHF/UHF en rutas costeras/llanuras. Señales estables y de largo alcance.
        </li>
        <li>
        <strong>Línea gris:</strong>
        Ventana en amanecer/atardecer con mínima absorción. Ideal para DX en baja HF o saltos largos en media/alta.
        </li>
        <li>
        <strong>MUF alta:</strong>
        Frecuencias altas (10–15 m) abiertas. Subí de banda para rutas largas.
        </li>
        <li>
        <strong>LUF alta/D‑layer:</strong>
        Baja HF atenuada de día. Bajá pérdidas usando bandas medias o esperá la noche.
        </li>
        <li>
        <strong>Aurora:</strong>
        VHF con audio áspero y trayectorias polares; HF degradada. Explorar 2 m/6 m.
        </li>
        <li>
        <strong>MS (meteoros):</strong>
        Ráfagas breves en VHF. Usar modos rápidos y apuntar a horarios de lluvias meteoríticas.
        </li>
    </ul>
    </section>

  </main>

    <footer class="footer">
    <div>POC local — 2025 © Ariel LU8EIB — Calabazas Bits</div>
    <div class="note">Fuentes: Open‑Meteo, NOAA SWPC, HamQSL (N0NBH)</div>
    </footer>


  <script src="assets/app.js"></script>
</body>
</html>